<!DOCTYPE html>
<html style="height: 100%;margin: 0;padding: 0;">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.29.1/moment.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/suncalc/1.9.0/suncalc.min.js"></script>
    <script type="text/javascript" src="https://livejs.com/live.js"></script>
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <title>Josh & Sadie Dashboard</title>
    <style>
    @font-face {
        font-family: 'Droid Sans Mono';
        src: url(DroidSansMono.ttf);
    }

    html,
    body {
        height: 100%;
        margin: 0;
        padding: 0;
        background: hsla(0, 0%, 80%, 1);
        font-family: 'Droid Sans Mono', monospace;
    }
    </style>
</head>

<body>
    <div style="display: flex; justify-content: center; height: 100%;">
        <svg id="svgContent" height="100%" width="100%" style="max-width: 100%;max-height: 100%;" version="1.1" viewBox="0 0 1600 900" xmlns="http://www.w3.org/2000/svg">
            <rect width="100%" height="100%" fill="hsla(0, 0%, 0%, 1)" />
            <svg id="clok" x=0 y=0 width="900" height="900" viewBox="0 0 900 900">
                <circle cx="450" cy="450" r="600" fill="hsla(38, 0%, 15%, 1)" />
                <circle cx="450" cy="450" r="550" fill="hsla(38, 0%, 25%, 1)" />
                <circle cx="450" cy="450" r="500" fill="hsla(38, 0%, 50%, 1)" />
                <circle cx="450" cy="450" r="450" fill="hsla(38, 0%, 100%, 1)" />
                <path id="sun" fill="none" stroke="hsla(194, 0%, 50%, 0.5)" stroke-width="450" />
                <line x1="450" y1="450" x2="450" y2="0" stroke="hsla(200, 100%, 50%, 1)" stroke-width="3" stroke-linecap="round" />
                <path id="nightSleep" fill="none" stroke="hsla(194, 100%, 50%, 0.2)" stroke-width="200" />
                <path id="napSleep" fill="none" stroke="hsla(194, 100%, 50%, 0.2)" stroke-width="200" />
                <path id="activities" fill="none" stroke="hsla(32, 100%, 50%, 0.3)" stroke-width="50" />
                <path id="activities2" fill="none" stroke="hsla(32, 100%, 50%, 0.3)" stroke-width="50" />
                <line id="timeBar3" x1="-10" y1="-10" x2="-10" y2="-10" stroke="hsla(356, 0%, 0%, 1)" stroke-width="24" stroke-linecap="round" />
                <line id="timeBar2" x1="-10" y1="-10" x2="-10" y2="-10" stroke="hsla(356, 100%, 50%, 0.5)" stroke-width="18" stroke-linecap="round" />
                <line id="timeBar" x1="-10" y1="-10" x2="-10" y2="-10" stroke="hsla(356, 100%, 50%, 1)" stroke-width="1" stroke-linecap="round" />
                <text id="timey" fill="hsla(0, 0%, 0%, .9)" x="50%" y="50%" dominant-baseline="middle" text-anchor="middle" style="font-size: 220px;font-weight: bold;"></text>
            </svg>
            <svg id="calBox" x=900 y=0 width="700" height="900" viewBox="0 0 700 900" style="overflow: visible;">
                <rect width="100%" height="100%" fill="white" stroke="black" stroke-width="1px" />
                <svg id="calendar2Svg" style="overflow: visible;" x="0" y="0" width="100%" height="100%" viewBox="0 0 245 400" preserveAspectRatio="xMinYMin meet" />
            </svg>
            <svg id="tempy" x=0 y="886" width="1600" height="14" viewBox="0 0 1200 10" display="none">
                <rect x="0" y="0" width="100" height="10" fill="hsla(194, 100%, 45%, 1)" /> <!-- -10 -->
                <rect x="100" y="0" width="100" height="10" fill="hsla(194, 100%, 50%, 1)" /> <!-- 00 -->
                <rect x="200" y="0" width="100" height="10" fill="hsla(194, 100%, 55%, 1)" /> <!-- 10 -->
                <rect x="300" y="0" width="100" height="10" fill="hsla(194, 100%, 60%, 1)" /> <!-- 20 -->
                <rect x="400" y="0" width="100" height="10" fill="hsla(194, 100%, 70%, 1)" /> <!-- 30 -->
                <rect x="500" y="0" width="100" height="10" fill="hsla(194, 100%, 80%, 1)" /> <!-- 40 -->
                <rect x="600" y="0" width="100" height="10" fill="hsla(194, 100%, 90%, 1)" /> <!-- 50 -->
                <rect x="700" y="0" width="100" height="10" fill="hsla(194, 100%, 95%, 1)" /> <!-- 60 -->
                <rect x="800" y="0" width="100" height="10" fill="hsla(194, 100%, 100%, 1)" /> <!-- 70 -->
                <rect x="900" y="0" width="100" height="10" fill="hsla(0, 100%, 90%, 1)" /> <!-- 70 -->
                <rect x="1000" y="0" width="100" height="10" fill="hsla(0, 100%, 80%, 1)" />
                <rect x="1100" y="0" width="100" height="10" fill="hsla(0, 100%, 70%, 1)" />
                <text fill="black" x="100" y="5" dominant-baseline="middle" text-anchor="middle" style="font-size: 10px;">0</text>
                <text fill="black" x="200" y="5" dominant-baseline="middle" text-anchor="middle" style="font-size: 10px;">10</text>
                <text fill="black" x="300" y="5" dominant-baseline="middle" text-anchor="middle" style="font-size: 10px;">20</text>
                <text fill="black" x="400" y="5" dominant-baseline="middle" text-anchor="middle" style="font-size: 10px;">30</text>
                <text fill="black" x="500" y="5" dominant-baseline="middle" text-anchor="middle" style="font-size: 10px;">40</text>
                <text fill="black" x="600" y="5" dominant-baseline="middle" text-anchor="middle" style="font-size: 10px;">50</text>
                <text fill="black" x="700" y="5" dominant-baseline="middle" text-anchor="middle" style="font-size: 10px;">60</text>
                <text fill="black" x="800" y="5" dominant-baseline="middle" text-anchor="middle" style="font-size: 10px;">70</text>
                <text fill="black" x="900" y="5" dominant-baseline="middle" text-anchor="middle" style="font-size: 10px;">80</text>
                <text fill="black" x="1000" y="5" dominant-baseline="middle" text-anchor="middle" style="font-size: 10px;">90</text>
                <text fill="black" x="1100" y="5" dominant-baseline="middle" text-anchor="middle" style="font-size: 10px;">100</text>
                <rect id="merc" x="0" y="2" width="0" height="5" fill="hsla(296, 100%, 50%, .5)" />
            </svg>
        </svg>
    </div>
    <script>
    //window.addEventListener("error", handleError, true);
    const momentProxy = (arg1) => moment(arg1).add(0, 'days');
    var svgcon = document.getElementById("svgContent");
    var calBox = document.getElementById("calBox");
    var clok = document.getElementById("clok");
    var tempy = document.getElementById("tempy");
    let weeks = 31;

    // The wake lock sentinel.
    let wakeLock = null;

    // Function that attempts to request a wake lock.
    const requestWakeLock = async () => {
        try {
            wakeLock = await navigator.wakeLock.request('screen');
            wakeLock.addEventListener('release', () => {
                console.log('Wake Lock was released');
            });
            console.log('Wake Lock is active');
        } catch (err) {
            console.error(`${err.name}, ${err.message}`);
        }
    };
    requestWakeLock();
    document.onclick = function() {
        document.documentElement.requestFullscreen();
    }

    addEventListener("resize", resize);

    function resize() {
        var natW = 1600;
        var natH = 900;
        var natR = natW / natH;

        var newR = window.innerWidth / window.innerHeight;
        var wider = newR > natR;
        var newW = wider ? natW * ((window.innerWidth / window.innerHeight) / (natW / natH)) : natW;
        var newH = !wider ? natH * ((window.innerHeight / window.innerWidth) / (natH / natW)) : natH;
        svgcon.setAttribute("viewBox", `0 0 ${newW} ${newH}`);

        var clockScale = newH / 900;
        clok.setAttribute("width", 900 * clockScale);
        clok.setAttribute("height", 900 * clockScale);
        calBox.setAttribute("x", newH);

        var calScale = (newW - newH) / 700;
        calBox.setAttribute("width", 700 * calScale);
        calBox.setAttribute("height", 100 * calScale * weeks);
        calBox.setAttribute("viewBox", `0 0 700 ${weeks * 100}`);

        tempy.setAttribute("y", newH - 14);
    }
    resize();

    function handleError(evt) {
        if (evt.message) { // Chrome sometimes provides this
            alert("error: " + evt.message + " at linenumber: " + evt.lineno + " of file: " + evt.filename);
        } else {
            alert("error: " + evt.type + " from element: " + (evt.srcElement || evt.target));
        }
    }
    (function() {
        var mouseTimer = null,
            cursorVisible = true;

        function disappearCursor() {
            mouseTimer = null;
            document.body.style.cursor = "none";
            cursorVisible = false;
        }

        document.onmousemove = function() {
            if (mouseTimer) {
                window.clearTimeout(mouseTimer);
            }
            if (!cursorVisible) {
                document.body.style.cursor = "default";
                cursorVisible = true;
            }
            mouseTimer = window.setTimeout(disappearCursor, 500);
        };
    })();

    for (var i = 0; i < 24; i++) {
        var angle = i * 15;
        var textl = polarToCartesian(450, 450, 430, angle);
        clok.innerHTML += `<text fill="hsla(0, 0%, 0%, .5)" x="${textl.x}" y="${textl.y}" dominant-baseline="middle" text-anchor="middle" style="font-size: 17px;">${(i+11)%12+1}</text>`;

        var lineStartl = polarToCartesian(450, 450, 50, angle);
        var lineEndl = polarToCartesian(450, 450, 400, angle);
        clok.innerHTML += `<line stroke-width="1" x1="${lineStartl.x}" y1="${lineStartl.y}" x2="${lineEndl.x}" y2="${lineEndl.y}" stroke="hsla(0, 0%, 0%, 1)" />`;
    }
    var fridayOffset = momentProxy().day() == 5 ? 0.9 : 0;
    document.getElementById("nightSleep")
        .setAttribute("d", describeArc(450, 450, 350, (-4.25 + fridayOffset) * 15, 7 * 15));
    document.getElementById("napSleep")
        .setAttribute("d", describeArc(450, 450, 350, 12.25 * 15, 15.25 * 15));
    if (momentProxy().day() != 0 && momentProxy().day() != 6)
        document.getElementById("activities")
        .setAttribute("d", describeArc(450, 450, 350, 8.75 * 15, 17 * 15));

    if (momentProxy().day() === 0) {

        document.getElementById("activities")
            .setAttribute("d", describeArc(450, 450, 350, 8.75 * 15, 11 * 15));
        document.getElementById("activities2")
            .setAttribute("d", describeArc(450, 450, 350, 16.25 * 15, 19.75 * 15));
    }

    var oldTime = momentProxy().hour();

    function getTime() {
        let now = momentProxy();
        let thruDay = now.hour() + now.minute() / 60 + now.second() / 60 / 60;
        let angle = thruDay * 15;
        var lineStartl = polarToCartesian(450, 450, 0, angle);
        var lineEndl = polarToCartesian(450, 450, 445, angle);
        var lineEnd2 = polarToCartesian(450, 450, 300, angle);
        let tb = document.getElementById("timeBar");
        let tb2 = document.getElementById("timeBar2");
        let tb3 = document.getElementById("timeBar3");
        tb.setAttribute('x1', lineStartl.x);
        tb.setAttribute('y1', lineStartl.y);
        tb.setAttribute('x2', lineEndl.x);
        tb.setAttribute('y2', lineEndl.y);
        tb2.setAttribute('x1', lineStartl.x);
        tb2.setAttribute('y1', lineStartl.y);
        tb2.setAttribute('x2', lineEnd2.x);
        tb2.setAttribute('y2', lineEnd2.y);
        tb3.setAttribute('x1', lineStartl.x);
        tb3.setAttribute('y1', lineStartl.y);
        tb3.setAttribute('x2', lineEnd2.x);
        tb3.setAttribute('y2', lineEnd2.y);
        let timey = document.getElementById("timey");
        timey.textContent = now.format('h:mm');
        var nowTime = momentProxy().hour();
        if (nowTime < oldTime) location.reload();
        oldTime = nowTime;
    }
    getTime();
    setInterval(getTime, 400);

    function getTextColors(dayToDraw) {
        let color = `transparent`;
        let textColor = `hsla(0, 0%, 0%, .3)`;
        color = monthColor(dayToDraw.month());
        switch (dayToDraw.day()) {
            case 0: //Sunday hsl(17deg 31% 76%)
                color = `hsla(23, 0%, 70%, 0.5)`;
                break;
            case 1: //Monday
                color = `hsla(250, 20%, 100%, 0.2)`;
                break;
            case 2: //Tuesday
                color = `hsla(200, 100%, 50%, 0.2)`;
                break;
            case 3: //Wednesday
                color = `hsla(83, 50%, 100%, 0.3)`;
                break;
            case 4: //Thursday
                color = `hsla(83, 50%, 100%, 0.3)`;
                break;
            case 5: //Friday
                color = `hsla(60, 100%, 50%, 0.4)`;
                break;
            case 6: //Saturday
                color = `hsla(23, 0%, 70%, 0.5)`;
                break;
            default:
                // code block
        }
        if (dayToDraw.isSame(moment("2022-11-24"))) color = `hsla(23, 0%, 70%, 0.5)`;
        if (dayToDraw.isSame(moment("2022-11-25"))) color = `hsla(23, 0%, 70%, 0.5)`;
        if (dayToDraw.isSame(moment("2022-12-26"))) color = `hsla(23, 0%, 70%, 0.5)`;
        if (dayToDraw.isSame(moment("2023-1-2"))) color = `hsla(23, 0%, 70%, 0.5)`;
        //if (dayToDraw.isSame(moment("2022-12-30"))) color = `hsla(23, 0%, 70%, 0.5)`;

        if (dayToDraw.dayOfYear() === momentProxy().dayOfYear()) {
            textColor = "hsla(0, 0%, 100%, 1)";
            color = "hsla(0, 0%, 0%, 1)";
        }
        return {
            color: color,
            textColor: textColor
        };
    }

    function monthColor(monthNumber) {
        switch (monthNumber) {
            case 0: //January
                return `hsla(10, 0%, 50%, .5)`;
            case 1: //February
                return `hsla(250, 20%, 50%, .5)`;
            case 2: //March
                return `hsla(40, 40%, 50%, .5)`;
            case 3: //April
                return `hsla(83, 50%, 50%, .5)`;
            case 4: //May
                return `hsla(208, 60%, 50%, .5)`;
            case 5: //June
                return `hsla(60, 100%, 50%, .5)`;
            case 6: //July
                return `hsla(50, 100%, 50%, .5)`;
            case 7: //August
                return `hsla(40, 80%, 50%, .5)`;
            case 8: //September
                return `hsla(200, 50%, 50%, .5)`;
            case 9: //October
                return `hsla(25, 100%, 50%, .5)`;
            case 10: //November
                return `hsla(330, 50%, 50%, .5)`;
            case 11: //December
                return `hsla(355, 100%, 50%, .5)`;
            default:
                return `hsla(10, 0%, 50%, 0.1)`;
        }
    }

    function drawCalendar() {
        let innerHTML = "";
        let startDate = momentProxy().clone().startOf('week').add(-(7 * 1), 'days');
        let dayToDraw = startDate.clone();
        let sunTimes = SunCalc.getTimes(new Date(), 40.910345, -81.399921);
        let ss = sunTimes.sunset;
        let sunsetHour = ss.getHours() + ss.getMinutes() / 60 + ss.getSeconds() / 60 / 60;
        let sunsetAngle = (24 - sunsetHour) * -15;
        let sr = sunTimes.sunrise;
        let sunriseHour = sr.getHours() + sr.getMinutes() / 60 + sr.getSeconds() / 60 / 60;
        let sunriseAngle = (sunriseHour) * 15;
        document.getElementById("sun")
            .setAttribute("d", describeArc(450, 450, 225, sunsetAngle, sunriseAngle));



        for (let i = 0; i < (7 * weeks); i++) {
            let colors = getTextColors(dayToDraw);
            let color = colors.color;
            let textColor = colors.textColor;

            var cellText = dayToDraw.date();
            if (dayToDraw.month() == 10 &&
                dayToDraw.date() > 21 &&
                dayToDraw.date() < 29 &&
                dayToDraw.day() === 4) cellText = "🦃";
            if (dayToDraw.month() == 9 &&
                dayToDraw.date() == 31) cellText = "🎃";
            if (dayToDraw.month() == 11 &&
                dayToDraw.date() == 25) cellText = "🎄";
            if (dayToDraw.month() == 6 &&
                dayToDraw.date() == 4) cellText = "🇺🇸";
            if (dayToDraw.month() == 11 &&
                dayToDraw.date() == 31) cellText = "🎂";
            if (dayToDraw.month() == 4 &&
                dayToDraw.date() > 24 &&
                dayToDraw.day() === 1) cellText = "🌷";
            if (dayToDraw.month() == 0 &&
                dayToDraw.date() == 1) cellText = "🎉";
            if (dayToDraw.month() == 8 &&
                dayToDraw.date() > 0 &&
                dayToDraw.date() < 8 &&
                dayToDraw.day() === 1) cellText = "🍉";
            if (dayToDraw.month() === 2 && dayToDraw.date() > 7 && dayToDraw.date() < 15 && dayToDraw.day() === 0)
                cellText = "🕖";
            if (dayToDraw.month() === 10 && dayToDraw.date() < 8 && dayToDraw.day() === 0)
                cellText = "🕖";
            if (dayToDraw.isSame("2022-12-30")) cellText = "🦘";
            if (!isNumeric(cellText)) textColor = `hsla(0, 0%, 0%, 1)`;


            innerHTML += `<rect x="${(i * 35) % (7*35)}" y="${Math.floor(i/7)*35}" width="35" height="35" fill="${color}" stroke="black" stroke-width=".1" />`;
            innerHTML += `<text fill="${textColor}" x="${((i * 35) % (7*35))+17.5}" y="${(Math.floor(i/7)*35)+17.5}" dominant-baseline="middle" text-anchor="middle" style="font-size: 20px;">${cellText}</text>`;
            dayToDraw.add(1, 'days');
        }


        for (var i = -1; i < 10; i++) {

            dayToDraw = momentProxy().clone().add(i, 'months');

            var pad = 2;
            var mStart = dayToDraw.clone().startOf('month');
            var mswEnd = mStart.clone().endOf('week').startOf('day');
            var mewEnd = mswEnd.clone().endOf('month').startOf('day');
            var mowbld = mewEnd.clone().add(-7, 'days');
            var mslwEnd = mowbld.clone().endOf('week').startOf('day');
            var mewStart = mewEnd.clone().startOf('week');
            var mowaStart = mStart.clone().add(7, 'days');
            var mowawStart = mowaStart.clone().startOf('week');


            innerHTML += `<path d="M ${mStart.day()*35 + pad} ${35 * Math.floor(mStart.diff(startDate, "days") / 7) + pad} ` +
                `L ${mswEnd.day()*35 + 35 - pad} ${35 * Math.floor(mswEnd.diff(startDate, "days") / 7) + pad} ` +
                `L ${mslwEnd.day()*35+35-pad} ${35 * Math.floor(mslwEnd.diff(startDate, "days") / 7)+35 - pad} ` +
                `L ${mowbld.day()*35+35-pad} ${35 * Math.floor(mowbld.diff(startDate, "days") / 7)+35 - pad} ` +
                `L ${mewEnd.day()*35+35-pad} ${35 * Math.floor(mewEnd.diff(startDate, "days") / 7)+35 - pad} ` +
                `L ${mewStart.day()*35+pad} ${35 * Math.floor(mewStart.diff(startDate, "days") / 7)+35 - pad} ` +
                `L ${mowawStart.day()*35+pad} ${35 * Math.floor(mowawStart.diff(startDate, "days") / 7) + pad} ` +
                `L ${mowaStart.day()*35+pad} ${35 * Math.floor(mowaStart.diff(startDate, "days") / 7) + pad} ` +
                `Z" fill="transparent" stroke-width="2" stroke-linejoin="round" stroke="${monthColor(mewStart.month())}"/>`;
        }

        document.getElementById(`calendar2Svg`).innerHTML = innerHTML;
        document.getElementById(`calendar2Svg`).setAttribute(`viewBox`, `0 0 245 ${weeks*35}`);



    }
    drawCalendar();
    const urlParams = new URLSearchParams(window.location.search);
    const appid = urlParams.get('appid');

    function getWeather() {
        if (appid) fetch(`https://api.openweathermap.org/data/2.5/weather?zip=44720,US&appid=${appid}&units=imperial`)
            .then(response => response.json())
            .then(data => {
                var feelsLike = Math.round(data.main.feels_like);
                console.log(feelsLike);
                var merc = document.getElementById("merc");
                tempy.setAttribute("display", "inline");
                merc.setAttribute('width', feelsLike * 10 + 100);

            });
    }
    getWeather();
    setInterval(getWeather, 1000 * 60 * 20);

    function polarToCartesian(centerX, centerY, radius, angleInDegrees) {
        var angleInRadians = (angleInDegrees - 90) * Math.PI / 180.0;

        return {
            x: centerX + (radius * Math.cos(angleInRadians)),
            y: centerY + (radius * Math.sin(angleInRadians))
        };
    }


    function isNumeric(n) {
        return !isNaN(parseFloat(n)) && isFinite(n);
    }


    function describeArc(x, y, radius, startAngle, endAngle) {

        var start = polarToCartesian(x, y, radius, endAngle);
        var end = polarToCartesian(x, y, radius, startAngle);

        var largeArcFlag = endAngle - startAngle <= 180 ? "0" : "1";

        var d = [
            "M", start.x, start.y,
            "A", radius, radius, 0, largeArcFlag, 0, end.x, end.y
        ].join(" ");

        return d;
    }
    </script>
</body>

</html>